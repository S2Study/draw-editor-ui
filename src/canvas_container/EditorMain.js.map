{"version":3,"file":"EditorMain.js","sourceRoot":"","sources":["EditorMain.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport * as styles from './EditorMainStyle.scss';\nimport DrawchatEditor = drawchat.editor.DrawchatEditor;\n\nclass Point{\n\tx:number;\n\ty:number;\n\tconstructor(x:number,y:number){\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t}\n}\n\nexport class EditorMainState{\n\tclick:boolean;\n\tmoving:boolean;\n\teditor:DrawchatEditor;\n\tmouseOut:(event:MouseEvent)=>void;\n\tmouseMove:(event:MouseEvent)=>void;\n\tmouseDown:(event:MouseEvent)=>void;\n\tmouseUp:(event:MouseEvent)=>void;\n\tconstructor(editor:DrawchatEditor){\n\t\tthis.editor = editor;\n\t}\n}\nexport interface EditorMainProps {\n\tid:string;\n\teditor:DrawchatEditor;\n}\nexport class EditorMain extends React.Component<EditorMainProps, EditorMainState> {\n\tconstructor(props:EditorMainProps) {\n\t\tsuper(props);\n\t\tthis.state = new EditorMainState(props.editor);\n\t}\n\n\tcomponentDidMount(): void {\n\t\tthis.state.editor.reRender();\n\t\tthis.state.editor.start();\n\t\tlet element = document.getElementById(this.props.id);\n\n\t\tthis.state.mouseMove = (event:MouseEvent)=>{\n\t\t\tif(!this.state.click){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.state.moving = true;\n\t\t\tlet point = this.getOffset(element,event);\n\t\t\tthis.props.editor.canvas.touchMove(point.x,point.y);\n\t\t};\n\t\tthis.state.mouseDown = (event:MouseEvent)=>{\n\t\t\tthis.state.click = true;\n\t\t\tlet point = this.getOffset(element,event);\n\t\t\tthis.props.editor.canvas.touchStart(point.x,point.y);\n\t\t};\n\t\tthis.state.mouseUp = (event:MouseEvent)=>{\n\t\t\tthis.drop(element,event);\n\t\t};\n\t\tthis.state.mouseOut = (event:MouseEvent)=>{\n\t\t\tif(!this.state.moving){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.drop(element,event);\n\t\t};\n\t\telement.addEventListener('mousemove',this.state.mouseMove);\n\t\telement.addEventListener('mousedown',this.state.mouseDown);\n\t\tdocument.addEventListener('mouseup',this.state.mouseUp);\n\t\telement.addEventListener('mouseout',this.state.mouseOut);\n\t}\n\n\tprivate getCursor():string{\n\n\t\tlet mode = this.state.editor.mode;\n\t\tswitch (mode.getMode()){\n\t\t\tcase mode.CHANGING:\n\t\t\t\treturn \"wait\";\n\t\t\tcase mode.CLIP_MODE:\n\t\t\t\treturn \"url(http://test.png),crosshair\";\n\t\t\tcase mode.ERASER_MODE:\n\t\t\t\treturn \"url(http://test.png),default\";\n\t\t\tcase mode.EYEDROPPER_MODE:\n\t\t\t\treturn \"url(http://test.png),default\";\n\t\t\tcase mode.FILL_MODE:\n\t\t\t\treturn \"url(http://test.png),default\";\n\t\t\tcase mode.TEXT_MODE:\n\t\t\t\treturn \"url(http://test.png),text\";\n\t\t\tcase mode.STROKE_MODE:\n\t\t\t\treturn \"url(http://test.png),default\";\n\t\t\tcase mode.HAND_TOOL_MODE:\n\t\t\t\treturn \"url(http://test.png),move\";\n\t\t\tdefault:\n\t\t\t\treturn \"auto\";\n\t\t}\n\t}\n\n\tprivate drop(element:Element,event:MouseEvent){\n\t\tthis.state.click = false;\n\t\tthis.state.moving = false;\n\t\tlet point = this.getOffset(element,event);\n\t\tthis.props.editor.canvas.touchEnd(point.x,point.y);\n\t}\n\n\tcomponentWillMount(): void {\n\t\tthis.state.editor.stop();\n\t\tlet element = document.getElementById(this.props.id);\n\n\t\tif(element == null){\n\t\t\treturn;\n\t\t}\n\t\telement.removeEventListener('mousemove',this.state.mouseMove);\n\t\telement.removeEventListener('mousedown',this.state.mouseDown);\n\t\tdocument.removeEventListener('mouseup',this.state.mouseUp);\n\t\telement.removeEventListener('mouseout',this.state.mouseOut);\n\t\tthis.state.mouseMove = null;\n\t\tthis.state.mouseDown = null;\n\t\tthis.state.mouseUp = null;\n\t}\n\n\tprivate getOffset(element:Element,event:MouseEvent):Point{\n\t\tlet mouseX = event.pageX ;\n\t\tlet mouseY = event.pageY ;\n\t\tlet rect = element.getBoundingClientRect() ;\n\t\tlet positionX = rect.left + window.pageXOffset ;\n\t\tlet positionY = rect.top + window.pageYOffset ;\n\t\treturn new Point(\n\t\t\tmouseX - positionX,\n\t\t\tmouseY - positionY\n\t\t);\n\t}\n\n\trender() {\n\t\tlet style={\n\t\t\twidth:this.props.editor.getWidth(),\n\t\t\theight:this.props.editor.getHeight(),\n\t\t\tcursor:this.getCursor()\n\t\t};\n\t\treturn(\n\t\t\t<div className={styles.container}>\n\t\t\t\t<div style={style} className={styles.container__background}>\n\t\t\t\t\t<div style={style} id={this.props.id} className={styles.container__canvas} />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n}\nexport default EditorMain;\n"]}