{"version":3,"file":"EditorMain.js","sourceRoot":"","sources":["EditorMain.tsx"],"names":[],"mappings":";;;;;;;;;;;;AAAA,6BAA+B;AAC/B,8CAAgD;AAGhD;IAIC,eAAY,CAAS,EAAE,CAAS;QAC/B,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;QACX,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;IACZ,CAAC;IACF,YAAC;AAAD,CAAC,AARD,IAQC;AAED,oBAAoB,KAAiB,IAAS,CAAC;AAE/C;IASC,yBAAY,MAAc;QACzB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;IACtB,CAAC;IACF,sBAAC;AAAD,CAAC,AAZD,IAYC;AAZY,0CAAe;AAiB5B;IAAgC,8BAAiD;IAEhF,oBAAY,KAAsB;QAAlC,YACC,kBAAM,KAAK,CAAC,SAEZ;QADA,KAAI,CAAC,KAAK,GAAG,IAAI,eAAe,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;;IAChD,CAAC;IAED,sCAAiB,GAAjB;QAAA,iBAiCC;QA/BA,IAAI,MAAM,GAAoB,IAAI,CAAC,KAAK,CAAC;QACzC,MAAM,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;QACzB,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;QACtB,IAAI,OAAO,GAAG,QAAQ,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAE,CAAC;QAEtD,MAAM,CAAC,SAAS,GAAG,UAAC,KAAiB;YACpC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;gBACnB,MAAM,CAAC;YACR,CAAC;YACD,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC;YACrB,IAAI,KAAK,GAAG,KAAI,CAAC,SAAS,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;YAC3C,KAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;QACtD,CAAC,CAAC;QACF,MAAM,CAAC,SAAS,GAAG,UAAC,KAAiB;YACpC,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC;YACpB,IAAI,KAAK,GAAG,KAAI,CAAC,SAAS,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;YAC3C,KAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;QACvD,CAAC,CAAC;QACF,MAAM,CAAC,OAAO,GAAG,UAAC,KAAiB;YAClC,KAAI,CAAC,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;QAC3B,CAAC,CAAC;QACF,MAAM,CAAC,QAAQ,GAAG,UAAC,KAAiB;YACnC,EAAE,CAAC,CAAC,CAAC,KAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;gBACxB,MAAM,CAAC;YACR,CAAC;YACD,KAAI,CAAC,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;QAC3B,CAAC,CAAC;QACF,OAAO,CAAC,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;QAC5D,OAAO,CAAC,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;QAC5D,QAAQ,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;QACzD,OAAO,CAAC,gBAAgB,CAAC,UAAU,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;IAC3D,CAAC;IAEO,8BAAS,GAAjB;QAEC,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC;QAClC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;YACxB,KAAK,IAAI,CAAC,QAAQ;gBACjB,MAAM,CAAC,MAAM,CAAC;YACf,KAAK,IAAI,CAAC,SAAS;gBAClB,MAAM,CAAC,gCAAgC,CAAC;YACzC,KAAK,IAAI,CAAC,WAAW;gBACpB,MAAM,CAAC,8BAA8B,CAAC;YACvC,KAAK,IAAI,CAAC,eAAe;gBACxB,MAAM,CAAC,8BAA8B,CAAC;YACvC,KAAK,IAAI,CAAC,SAAS;gBAClB,MAAM,CAAC,8BAA8B,CAAC;YACvC,KAAK,IAAI,CAAC,SAAS;gBAClB,MAAM,CAAC,2BAA2B,CAAC;YACpC,KAAK,IAAI,CAAC,WAAW;gBACpB,MAAM,CAAC,8BAA8B,CAAC;YACvC,KAAK,IAAI,CAAC,cAAc;gBACvB,MAAM,CAAC,2BAA2B,CAAC;YACpC;gBACC,MAAM,CAAC,MAAM,CAAC;QAChB,CAAC;IACF,CAAC;IAEO,yBAAI,GAAZ,UAAa,OAAgB,EAAE,KAAiB;QAC/C,IAAI,MAAM,GAAoB,IAAI,CAAC,KAAK,CAAC;QACzC,MAAM,CAAC,KAAK,GAAG,KAAK,CAAC;QACrB,MAAM,CAAC,MAAM,GAAG,KAAK,CAAC;QACtB,IAAI,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;QAC3C,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;IACrD,CAAC;IAED,uCAAkB,GAAlB;QACC,IAAI,MAAM,GAAoB,IAAI,CAAC,KAAK,CAAC;QACzC,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;QACrB,IAAI,OAAO,GAAG,QAAQ,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;QAErD,EAAE,CAAC,CAAC,OAAO,IAAI,IAAI,CAAC,CAAC,CAAC;YACrB,MAAM,CAAC;QACR,CAAC;QACD,OAAO,CAAC,mBAAmB,CAAC,WAAW,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC;QAC3D,OAAO,CAAC,mBAAmB,CAAC,WAAW,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC;QAC3D,QAAQ,CAAC,mBAAmB,CAAC,SAAS,EAAE,MAAM,CAAC,OAAO,CAAC,CAAC;QACxD,OAAO,CAAC,mBAAmB,CAAC,UAAU,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;QACzD,MAAM,CAAC,SAAS,GAAG,UAAU,CAAC;QAC9B,MAAM,CAAC,SAAS,GAAG,UAAU,CAAC;QAC9B,MAAM,CAAC,OAAO,GAAG,UAAU,CAAC;IAC7B,CAAC;IAEO,8BAAS,GAAjB,UAAkB,OAAgB,EAAE,KAAiB;QACpD,IAAI,MAAM,GAAG,KAAK,CAAC,KAAK,CAAC;QACzB,IAAI,MAAM,GAAG,KAAK,CAAC,KAAK,CAAC;QACzB,IAAI,IAAI,GAAG,OAAO,CAAC,qBAAqB,EAAE,CAAC;QAC3C,IAAI,SAAS,GAAG,IAAI,CAAC,IAAI,GAAG,MAAM,CAAC,WAAW,CAAC;QAC/C,IAAI,SAAS,GAAG,IAAI,CAAC,GAAG,GAAG,MAAM,CAAC,WAAW,CAAC;QAC9C,MAAM,CAAC,IAAI,KAAK,CACf,MAAM,GAAG,SAAS,EAClB,MAAM,GAAG,SAAS,CAClB,CAAC;IACH,CAAC;IAED,2BAAM,GAAN;QACC,IAAI,KAAK,GAAG;YACX,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,EAAE;YACnC,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,SAAS,EAAE;YACrC,MAAM,EAAE,IAAI,CAAC,SAAS,EAAE;SACxB,CAAC;QACF,MAAM,CAAC,CACN,6BAAK,SAAS,EAAE,MAAM,CAAC,SAAS;YAC/B,6BAAK,KAAK,EAAE,KAAK,EAAE,SAAS,EAAE,MAAM,CAAC,qBAAqB;gBACzD,6BAAK,KAAK,EAAE,KAAK,EAAE,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,SAAS,EAAE,MAAM,CAAC,iBAAiB,GAAG,CACvE,CACD,CACN,CAAC;IACH,CAAC;IACF,iBAAC;AAAD,CAAC,AAtHD,CAAgC,KAAK,CAAC,SAAS,GAsH9C;AAtHY,gCAAU;AAuHvB,kBAAe,UAAU,CAAC","sourcesContent":["import * as React from \"react\";\nimport * as styles from \"./EditorMainStyle.css\";\nimport {Editor} from \"@s2study/draw-editor/lib/Editor\";\n\nclass Point {\n\tx: number;\n\ty: number;\n\n\tconstructor(x: number, y: number) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t}\n}\n\nfunction EMPTY_FUNC(event: MouseEvent): void {}\n\nexport class EditorMainState {\n\tclick: boolean;\n\tmoving: boolean;\n\teditor: Editor;\n\tmouseOut: (event: MouseEvent) => void;\n\tmouseMove: (event: MouseEvent) => void;\n\tmouseDown: (event: MouseEvent) => void;\n\tmouseUp: (event: MouseEvent) => void;\n\n\tconstructor(editor: Editor) {\n\t\tthis.editor = editor;\n\t}\n}\nexport interface EditorMainProps {\n\tid: string;\n\teditor: Editor;\n}\nexport class EditorMain extends React.Component<EditorMainProps, EditorMainState> {\n\n\tconstructor(props: EditorMainProps) {\n\t\tsuper(props);\n\t\tthis.state = new EditorMainState(props.editor);\n\t}\n\n\tcomponentDidMount(): void {\n\n\t\tlet state1: EditorMainState = this.state;\n\t\tstate1.editor.reRender();\n\t\tstate1.editor.start();\n\t\tlet element = document.getElementById(this.props.id)!;\n\n\t\tstate1.mouseMove = (event: MouseEvent) => {\n\t\t\tif (!state1.click) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tstate1.moving = true;\n\t\t\tlet point = this.getOffset(element, event);\n\t\t\tthis.props.editor.canvas.touchMove(point.x, point.y);\n\t\t};\n\t\tstate1.mouseDown = (event: MouseEvent) => {\n\t\t\tstate1.click = true;\n\t\t\tlet point = this.getOffset(element, event);\n\t\t\tthis.props.editor.canvas.touchStart(point.x, point.y);\n\t\t};\n\t\tstate1.mouseUp = (event: MouseEvent) => {\n\t\t\tthis.drop(element, event);\n\t\t};\n\t\tstate1.mouseOut = (event: MouseEvent) => {\n\t\t\tif (!this.state.moving) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.drop(element, event);\n\t\t};\n\t\telement.addEventListener(\"mousemove\", this.state.mouseMove);\n\t\telement.addEventListener(\"mousedown\", this.state.mouseDown);\n\t\tdocument.addEventListener(\"mouseup\", this.state.mouseUp);\n\t\telement.addEventListener(\"mouseout\", this.state.mouseOut);\n\t}\n\n\tprivate getCursor(): string {\n\n\t\tlet mode = this.state.editor.mode;\n\t\tswitch (mode.getMode()) {\n\t\t\tcase mode.CHANGING:\n\t\t\t\treturn \"wait\";\n\t\t\tcase mode.CLIP_MODE:\n\t\t\t\treturn \"url(http://test.png),crosshair\";\n\t\t\tcase mode.ERASER_MODE:\n\t\t\t\treturn \"url(http://test.png),default\";\n\t\t\tcase mode.EYEDROPPER_MODE:\n\t\t\t\treturn \"url(http://test.png),default\";\n\t\t\tcase mode.FILL_MODE:\n\t\t\t\treturn \"url(http://test.png),default\";\n\t\t\tcase mode.TEXT_MODE:\n\t\t\t\treturn \"url(http://test.png),text\";\n\t\t\tcase mode.STROKE_MODE:\n\t\t\t\treturn \"url(http://test.png),default\";\n\t\t\tcase mode.HAND_TOOL_MODE:\n\t\t\t\treturn \"url(http://test.png),move\";\n\t\t\tdefault:\n\t\t\t\treturn \"auto\";\n\t\t}\n\t}\n\n\tprivate drop(element: Element, event: MouseEvent) {\n\t\tlet state1: EditorMainState = this.state;\n\t\tstate1.click = false;\n\t\tstate1.moving = false;\n\t\tlet point = this.getOffset(element, event);\n\t\tthis.props.editor.canvas.touchEnd(point.x, point.y);\n\t}\n\n\tcomponentWillMount(): void {\n\t\tlet state1: EditorMainState = this.state;\n\t\tstate1.editor.stop();\n\t\tlet element = document.getElementById(this.props.id);\n\n\t\tif (element == null) {\n\t\t\treturn;\n\t\t}\n\t\telement.removeEventListener(\"mousemove\", state1.mouseMove);\n\t\telement.removeEventListener(\"mousedown\", state1.mouseDown);\n\t\tdocument.removeEventListener(\"mouseup\", state1.mouseUp);\n\t\telement.removeEventListener(\"mouseout\", state1.mouseOut);\n\t\tstate1.mouseMove = EMPTY_FUNC;\n\t\tstate1.mouseDown = EMPTY_FUNC;\n\t\tstate1.mouseUp = EMPTY_FUNC;\n\t}\n\n\tprivate getOffset(element: Element, event: MouseEvent): Point {\n\t\tlet mouseX = event.pageX;\n\t\tlet mouseY = event.pageY;\n\t\tlet rect = element.getBoundingClientRect();\n\t\tlet positionX = rect.left + window.pageXOffset;\n\t\tlet positionY = rect.top + window.pageYOffset;\n\t\treturn new Point(\n\t\t\tmouseX - positionX,\n\t\t\tmouseY - positionY\n\t\t);\n\t}\n\n\trender() {\n\t\tlet style = {\n\t\t\twidth: this.props.editor.getWidth(),\n\t\t\theight: this.props.editor.getHeight(),\n\t\t\tcursor: this.getCursor()\n\t\t};\n\t\treturn (\n\t\t\t<div className={styles.container}>\n\t\t\t\t<div style={style} className={styles.container__background}>\n\t\t\t\t\t<div style={style} id={this.props.id} className={styles.container__canvas}/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n}\nexport default EditorMain;\n"]}